# Harberger

This is a list of messages that can be sent by users, it doesn't include the messages that are received from the server.

## Common fields

Notice that outside of the content, which is phase specific and will be interpreted by the phase handler, there is a number of items that are (optionally) present in every message and have always the same meaning

### Phase

An integer showing to which phase the message belongs

### Round

The current round

### Number

The player number. It is often used as player identifier and in harberger, futarchy and voting it is univocally associated with the role

1. Owner
2. Developer
3. Owner
4. Owner
5. Owner
6. Owner
7. Speculator (Harbeger and Futarchy)
8. Speculator (Harbeger and Futarchy)
9. Speculator (Harbeger and Futarchy)
10. Speculator (Harbeger and Futarchy)
11. Speculator (Harbeger and Futarchy)
12. Speculator (Harbeger and Futarchy)

### Type

Should be "message".

## Common

### Phase Timeout

An event automatically triggered by the server when a phase's timeout is triggered.

```
{
    "content": {
        "phase": 1,
        "round": 0
    },
    "type": "phase-timeout",
    "phase": 1,
    "round": 0
}
```

### Join

An event triggered by a player joining the game. A player may rejoin the game later on in every phase.

```
{
    "content": {
        "gameId": 149,
        "type": "join",
        "recovery": "5lmcp6739wck6fbhuf1y7s59537hrgek4a9dxbhuflod0fs6mu90kya1yf9dc540"
    },
    "phase": 0,
    "round": 0,
    "type": "message"
}
```

## Phase 0

### Player is Ready

The game waits until all players declare themselves ready.

```
{
    "content": {
        "gameId": 149,
        "type": "player-is-ready"
    },
    "number": 2,
    "tag": "Developer",
    "phase": 0,
    "round": 0,
    "type": "message"
}
```

## Phase 1

Nothing in particular happens in phase 1, all players are shown their private and some public data.

## Phase 2

Each player owning a property should declare its expected revenue for the round. The declaration is an array, one per condition. 0 is the status quo, 1 represents the development of the project. Originally there were intended more project to be selectable, it is still advisable to send a third item with the value set to 0.

```
{
    "content": {
        "gameId": 149,
        "type": "declare",
        "declaration": [
            598000,
            215000,
            0
        ]
    },
    "number": 3,
    "tag": "Owner 2",
    "phase": 2,
    "round": 0,
    "type": "message"
}
```

## Phase 3

At this phase the winning project is already known. Speculator may decide to take advantage of suspicious declarations by "overtaking" the business. This happens when the declared revenue is low enough to be quite sure it's possible to make more. In reality, in this game there is no takeover, but just a penalty applied to the property owner (if the declaration was indeed below the expected revenue) or vice versa, if the speculator was wrong. The penalty is half the gap between the declared and the expected revenue and can go either way: a speculator might receive a penalty if the declaration was above the expected revenue.

When a speculator has decided, he sends an array of array. The main array contains an array per each condition (0: status quo, 1: project). In the example it is clear that the status quo is the winning condition.
In the condition array there is a list of owners whose declaration is to be challenged.

### Speculation

```
{
    "content": {
        "gameId": 888,
        "type": "done-speculating",
        "snipe": [
            [
                2,
                3
            ],
            []
        ]
    },
    "number": 4,
    "tag": "Speculator 1",
    "phase": 3,
    "round": 1,
    "type": "message"
}
```

## Phase 4

Players wait in this phase.

## Phase 5

Players wait in this phase.

## Phase 6

During the market phase it is possible to post and cancel orders.

### Post Order

```
{
    "content": {
        "order": {
            "price": 3560,
            "quantity": 1,
            "condition": 0,
            "type": "ask",
            "now": false
        },
        "gameId": 888,
        "type": "post-order"
    },
    "number": 5,
    "tag": "Speculator 2",
    "phase": 6,
    "round": 1,
    "type": "message"
}
```

An order can be an attempt to sell (ask) or to buy (bid) a share of the social revenue (taxes) generated by the winning condition. The parameter **type** expresses this.

The **quantity** is always one: it was originally requested to be flexible (even to allow for decimal) but for simplicity it is possible to trade only one share at a time.

In Harbeger the **condition** is the winning condition.

The **price** is always set.

The **now** parameter, if set to true, tells the server to ignore the price indicated and resolve the user request at the best price avaible (buy at the lowest, sell at the highest). If it is false, the bid or ask will be resolved when a matching order is posted by somebody else.

An order not immediately resolved is placed in the list of bids and asks for other traders to see.

### Cancel Order

Each submitted order, if accepted, receives an id, which is made public through a server message. The player who submitted the order can subsequently cancel it, before it is fulfilled.

```
{
    "content": {
        "order": {
            "id": 4,
            "condition": 0
        },
        "gameId": 261,
        "type": "cancel-order"
    },
    "number": 6,
    "tag": "Owner 5",
    "phase": 6,
    "round": 0,
    "type": "message"
}
```

## Phase 7

In phase 7 a second declaration is submitted, similarly to phase 2.

### Declare

```
{
    "content": {
        "gameId": 149,
        "type": "declare",
        "declaration": [
            598000,
            215000,
            0
        ]
    },
    "number": 3,
    "tag": "Owner 2",
    "phase": 2,
    "round": 0,
    "type": "message"
}
```

## Phase 8

In phase 8 happens a new round of speculations.

### Speculation

```
{
    "content": {
        "gameId": 888,
        "type": "done-speculating",
        "snipe": [
            [
                2,
                3
            ],
            []
        ]
    },
    "number": 4,
    "tag": "Speculator 1",
    "phase": 3,
    "round": 1,
    "type": "message"
}
```


## Phase 9

In phase 9 players are shown their results and wait for the next round to start.
